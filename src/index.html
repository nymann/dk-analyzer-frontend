<!DOCTYPE html>
  <head> </head>
  <body>
    <form>
  <label for="report_id">Report ID:</label>
  <input type="text" id="report_id" name="report_id"><br>

  <label for="fight_id">Fight ID:</label>
  <input type="text" id="fight_id" name="fight_id" value="1"><br>

  <button type="button" onclick="submitForm()">Submit</button>
    </form>
    <div>
      <canvas id="myChart"></canvas>
    </div>
  </body>

   <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.3.0/chart.min.js'></script>
   <script src='https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.1/dist/chartjs-plugin-annotation.min.js'></script>
  <script>
        var scatterChart = null;
        function submitForm() {
          const reportId = document.getElementById('report_id').value;
          const fightId = document.getElementById('fight_id').value;
        
          generateChart(reportId, fightId);
        }

        function generateChart(report_id, fight_id) {

    // Get the API response containing the x and y values
    fetch(
            `http://localhost:5111/deathstrikeusage?report_id=${report_id}&fight_id=${fight_id}`
    )
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((data) => {
        // Extract the x and y values from the API response
        const xValues = data["rp_list"];
        const yValues = data["hp_list"];

        // Create a scatter chart using Chart.js
        const ctx = document.getElementById("myChart");
        if(scatterChart != null) {
                scatterChart.destroy();
        }
        scatterChart = new Chart(ctx, {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "Death Strike Usage",
                data: xValues.map((x, i) => ({ x, y: yValues[i] })),
                backgroundColor: "#1F77B4",
              },
            ],
          },
          options: {
            scales: {
              x: {
                type: "linear",
                position: "bottom",
                title: {
                  display: true,
                  text: "Runic Power",
                },
              },
              y: {
                type: "linear",
                position: "left",
                title: {
                  display: true,
                  text: "HP%",
                },
              },
            },
          plugins: {
            annotation: {
              annotations: {
                rp: {
                  type: 'line',
                  mode: 'vertical',
                  scaleID: 'x',
                  value: 95,
                  borderColor: 'red',
                  borderWidth: 2,
                },
                hp: {
                  type: 'line',
                  yMin: 70,
                  yMax: 70,
                  xMax: 95,
                  borderColor: '#FEBD0D',
                  borderWidth: 2,
                },
                wasteful: {
                  type: 'box',
                  yMin: 70,
                  yMax: 100,
                  xMin: 35,
                  xMax: 95,
                  backgroundColor: 'rgba(0, 0, 0, 0.1)',
                  borderWidth: 0,
                }
              }
             }
          },
         },
        });
      })
      .catch((error) => {
        console.error("There was a problem with the API call:", error);
      });
        }
  </script>
</html>
